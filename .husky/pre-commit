#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "🚀 Preparing to push changes..."

echo "🧪 Running unit tests..."
if dotnet test --filter "Category=Unit" --logger "console;verbosity=detailed"; then
    echo "✅ All unit tests passed successfully!"
else
    echo "❌ Some tests failed. Please fix them before pushing."
    exit 1
fi

echo "🎨 Checking C# file formatting with CSharpier..."
if dotnet csharpier . --check; then
    echo "✅ All files are properly formatted."
else
    echo "❌ Some files need formatting. Formatting now..."
    dotnet csharpier .
    echo "✅ Files formatted successfully. Adding to commit..."
    git add .
fi

echo "🛠️ Running format check on staged files..."
dotnet husky run --name dotnet-format-csharpier

echo "🚀 Ready to commit changes!"
echo "✅ Pre-commit checks completed successfully."
